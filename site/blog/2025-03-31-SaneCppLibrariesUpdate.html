<!DOCTYPE html>
<html lang="en">
  <head>
      <title>Sane Coding Blog - ‚òîÔ∏è Sane C++ March 25</title>
      <meta charset="utf-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <link rel="shortcut icon" href="https://pagghiu.github.io/images/favicon.png">
      <link rel="icon" type="image/x-icon" href="https://pagghiu.github.io/images/favicon.png">
      <link rel="apple-touch-icon" href="https://pagghiu.github.io/images/favicon.png" type="image/png" sizes="180x180">    
        <meta name="description" content="Sane Coding Blog" />
        <link rel="stylesheet" type="text/css" href="https://pagghiu.github.io/theme/css/pico2/all.css" />
        <link href="https://pagghiu.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Sane Coding Blog Full Atom Feed" />
        <link href="https://pagghiu.github.io/feeds/sanecpplibraries.atom.xml" type="application/atom+xml" rel="alternate" title="Sane Coding Blog Categories Atom Feed" />





  </head>

  <body style="min-height: 786px;">
    <header class="is-fixed-above-lg is-fixed">
      <div class="container">
        <a aria-label="Sane Coding homepage" href="https://pagghiu.github.io/">
          <img focusable="false" src="https://pagghiu.github.io/images/logo.png" style="display: block; width: 6rem" />
        </a>
        <nav class="container-fluid">
          <ul>
            <li class="hide-before-sm">Sane Coding Blog</li>
          </ul>
        </nav>
        <nav>
          <ul>
            <li><a class="secondary" href="https://pagghiu.github.io/site/projects/projects.html">Projects</a></li>
            <li><a class="secondary" href="https://pagghiu.github.io/site/blog/blog.html">Blog</a></li>
            <li><a class="secondary" href="https://pagghiu.github.io/site/pages/about.html">About</a></li>
            <li><a class="contrast theme-switcher" aria-label="Turn off dark mode" href=""><svg
                  xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 32 32" fill="currentColor"
                  class="icon-theme-toggle">
                  <clippath id="theme-toggle-cutout">
                    <path d="M0-11h25a1 1 0 0017 13v30H0Z"></path>
                  </clippath>
                  <g clip-path="url(#theme-toggle-cutout)">
                    <circle cx="16" cy="16" r="8.4"></circle>
                    <path
                      d="M18.3 3.2c0 1.3-1 2.3-2.3 2.3s-2.3-1-2.3-2.3S14.7.9 16 .9s2.3 1 2.3 2.3zm-4.6 25.6c0-1.3 1-2.3 2.3-2.3s2.3 1 2.3 2.3-1 2.3-2.3 2.3-2.3-1-2.3-2.3zm15.1-10.5c-1.3 0-2.3-1-2.3-2.3s1-2.3 2.3-2.3 2.3 1 2.3 2.3-1 2.3-2.3 2.3zM3.2 13.7c1.3 0 2.3 1 2.3 2.3s-1 2.3-2.3 2.3S.9 17.3.9 16s1-2.3 2.3-2.3zm5.8-7C9 7.9 7.9 9 6.7 9S4.4 8 4.4 6.7s1-2.3 2.3-2.3S9 5.4 9 6.7zm16.3 21c-1.3 0-2.3-1-2.3-2.3s1-2.3 2.3-2.3 2.3 1 2.3 2.3-1 2.3-2.3 2.3zm2.4-21c0 1.3-1 2.3-2.3 2.3S23 7.9 23 6.7s1-2.3 2.3-2.3 2.4 1 2.4 2.3zM6.7 23C8 23 9 24 9 25.3s-1 2.3-2.3 2.3-2.3-1-2.3-2.3 1-2.3 2.3-2.3z">
                    </path>
                  </g>
                </svg>
                <script src="https://pagghiu.github.io/theme/js/commons.min.pico2.js"></script>
              </a></li>
          </ul>
          <ul class="icons">
            <li><a rel="noopener noreferrer" class="contrast" aria-label="GitHub repository"
                href="https://github.com/pagghiu/SaneCppLibraries" target="_blank"><svg xmlns="http://www.w3.org/2000/svg"
                  height="24" width="24.25" viewBox="0 0 496 512" class="icon-github">
                  <path
                    d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z">
                  </path>
                </svg></a></li>
            <li><a href="https://bsky.app/profile/pagghiu.bsky.social" target="_blank" class="contrast" aria-label="Bluesky"><svg
                  aria-hidden="true" focusable="false" role="img" xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 612 612" width="16px" height="16px">
                    <path d="m135.72 44.03c66.496 49.921 138.02 151.14 164.28 205.46 26.262-54.316 97.782-155.54 164.28-205.46 47.98-36.021 125.72-63.892 125.72 24.795 0 17.712-10.155 148.79-16.111 170.07-20.703 73.984-96.144 92.854-163.25 81.433 117.3 19.964 147.14 86.092 82.697 152.22-122.39 125.59-175.91-31.511-189.63-71.766-2.514-7.3797-3.6904-10.832-3.7077-7.8964-0.0174-2.9357-1.1937 0.51669-3.7077 7.8964-13.714 40.255-67.233 197.36-189.63 71.766-64.444-66.128-34.605-132.26 82.697-152.22-67.108 11.421-142.55-7.4491-163.25-81.433-5.9562-21.282-16.111-152.36-16.111-170.07 0-88.687 77.742-60.816 125.72-24.795z" fill="#1185fe"/>
                   </svg>
              </a></li>
            <li><a rel="noopener noreferrer" class="contrast" aria-label="Twitter" href="https://twitter.com/pagghiu_"
                target="_blank"><svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 512 512"
                  class="icon-x">
                  <path
                    d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z">
                  </path>
                </svg></a></li>
            <li><a href="https://www.youtube.com/@Pagghiu" target="_blank" class="contrast"
                aria-label="Youtube Channel"><svg aria-hidden="true" focusable="false" role="img"
                  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 180" height="16px">
                  <path fill="red"
                    d="M250.346 28.075A32.18 32.18 0 0 0 227.69 5.418C207.824 0 127.87 0 127.87 0S47.912.164 28.046 5.582A32.18 32.18 0 0 0 5.39 28.24c-6.009 35.298-8.34 89.084.165 122.97a32.18 32.18 0 0 0 22.656 22.657c19.866 5.418 99.822 5.418 99.822 5.418s79.955 0 99.82-5.418a32.18 32.18 0 0 0 22.657-22.657c6.338-35.348 8.291-89.1-.164-123.134" />
                  <path fill="#FFF" d="m102.421 128.06l66.328-38.418l-66.328-38.418z" />
                </svg></a></li>
                <li><a href="https://discord.gg/tyBfFp33Z6" target="_blank" class="contrast" aria-label="Discord Chat"><svg
                  aria-hidden="true" focusable="false" role="img" xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 -28.5 256 256" height="16px">
                  <path
                    d="M216.856339,16.5966031 C200.285002,8.84328665 182.566144,3.2084988 164.041564,0 C161.766523,4.11318106 159.108624,9.64549908 157.276099,14.0464379 C137.583995,11.0849896 118.072967,11.0849896 98.7430163,14.0464379 C96.9108417,9.64549908 94.1925838,4.11318106 91.8971895,0 C73.3526068,3.2084988 55.6133949,8.86399117 39.0420583,16.6376612 C5.61752293,67.146514 -3.4433191,116.400813 1.08711069,164.955721 C23.2560196,181.510915 44.7403634,191.567697 65.8621325,198.148576 C71.0772151,190.971126 75.7283628,183.341335 79.7352139,175.300261 C72.104019,172.400575 64.7949724,168.822202 57.8887866,164.667963 C59.7209612,163.310589 61.5131304,161.891452 63.2445898,160.431257 C105.36741,180.133187 151.134928,180.133187 192.754523,160.431257 C194.506336,161.891452 196.298154,163.310589 198.110326,164.667963 C191.183787,168.842556 183.854737,172.420929 176.223542,175.320965 C180.230393,183.341335 184.861538,190.991831 190.096624,198.16893 C211.238746,191.588051 232.743023,181.531619 254.911949,164.955721 C260.227747,108.668201 245.831087,59.8662432 216.856339,16.5966031 Z M85.4738752,135.09489 C72.8290281,135.09489 62.4592217,123.290155 62.4592217,108.914901 C62.4592217,94.5396472 72.607595,82.7145587 85.4738752,82.7145587 C98.3405064,82.7145587 108.709962,94.5189427 108.488529,108.914901 C108.508531,123.290155 98.3405064,135.09489 85.4738752,135.09489 Z M170.525237,135.09489 C157.88039,135.09489 147.510584,123.290155 147.510584,108.914901 C147.510584,94.5396472 157.658606,82.7145587 170.525237,82.7145587 C183.391518,82.7145587 193.761324,94.5189427 193.539891,108.914901 C193.539891,123.290155 183.391518,135.09489 170.525237,135.09489 Z"
                    fill="#5865F2" fill-rule="nonzero"> </path>
                </svg></a></li>                 
            <li><a href="https://mastodon.gamedev.place/@pagghiu" target="_blank" class="contrast"
                aria-label="Mastodon"><svg aria-hidden="true" focusable="false" role="img"
                  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                  style="enable-background:new 0 0 1668.56 1221.19;" height="16px">
                  <path
                    d="M21.327 8.566c0-4.339-2.843-5.61-2.843-5.61-1.433-.658-3.894-.935-6.451-.956h-.063c-2.557.021-5.016.298-6.45.956 0 0-2.843 1.272-2.843 5.61 0 .993-.019 2.181.012 3.441.103 4.243.778 8.425 4.701 9.463 1.809.479 3.362.579 4.612.51 2.268-.126 3.541-.809 3.541-.809l-.075-1.646s-1.621.511-3.441.449c-1.804-.062-3.707-.194-3.999-2.409a4.523 4.523 0 0 1-.04-.621s1.77.433 4.014.536c1.372.063 2.658-.08 3.965-.236 2.506-.299 4.688-1.843 4.962-3.254.434-2.223.398-5.424.398-5.424zm-3.353 5.59h-2.081V9.057c0-1.075-.452-1.62-1.357-1.62-1 0-1.501.647-1.501 1.927v2.791h-2.069V9.364c0-1.28-.501-1.927-1.502-1.927-.905 0-1.357.546-1.357 1.62v5.099H6.026V8.903c0-1.074.273-1.927.823-2.558.566-.631 1.307-.955 2.228-.955 1.065 0 1.872.409 2.405 1.228l.518.869.519-.869c.533-.819 1.34-1.228 2.405-1.228.92 0 1.662.324 2.228.955.549.631.822 1.484.822 2.558v5.253z" />
                </svg></a></li>
          </ul>
        </nav>
      </div>
    </header>
    <main class="container has-table-of-contents">
<aside id="documentation-menu">
    <nav class="is-sticky-above-lg" style="--max-height: 674.75px;">
        <details open="">
            <summary>Projects</summary>
            <ul>
                <li><a class="secondary" href="https://pagghiu.github.io/site/projects/SaneCppLibraries.html"
                        title="Permalink to Sane C++ Libraries">Sane C++ Libraries
                    </a></li>
            </ul>
        </details>
        <details open="">
            <summary>Blog</summary>
            <ul>
                <!--- articles_page.object_list --->
                <li>
                    <a class="secondary" href="https://pagghiu.github.io/site/blog/2025-05-31-SaneCppLibrariesUpdate.html" title="Permalink to üå∏ Sane C++ May 25">
                    üå∏ Sane C++ May 25
                    <br>
                </a>
            </li>
                <li>
                    <a class="secondary" href="https://pagghiu.github.io/site/blog/2025-04-30-SaneCppLibrariesUpdate.html" title="Permalink to üí§ Sane C++ April 25">
                    üí§ Sane C++ April 25
                    <br>
                </a>
            </li>
                <li>
                    <a class="secondary" aria-current="page" href="" title="Permalink to ‚òîÔ∏è Sane C++ March 25">
                    ‚òîÔ∏è Sane C++ March 25
                    <br>
                </a>
            </li>
                <li>
                    <a class="secondary" href="https://pagghiu.github.io/site/blog/2025-02-28-SaneCppLibrariesUpdate.html" title="Permalink to üé† Sane C++ February 25">
                    üé† Sane C++ February 25
                    <br>
                </a>
            </li>
                <li>
                    <a class="secondary" href="https://pagghiu.github.io/site/blog/2025-01-31-SaneCppLibrariesUpdate.html" title="Permalink to ‚ùÑÔ∏è Sane C++ January 25">
                    ‚ùÑÔ∏è Sane C++ January 25
                    <br>
                </a>
            </li>
                <li>
                    <a class="secondary" href="https://pagghiu.github.io/site/blog/2024-12-31-SaneCppLibrariesUpdate.html" title="Permalink to ‚òÉÔ∏è Sane C++ December 24">
                    ‚òÉÔ∏è Sane C++ December 24
                    <br>
                </a>
            </li>
                <li>
                    <a class="secondary" href="https://pagghiu.github.io/site/blog/2024-12-23-SaneCpp1Year.html" title="Permalink to 1Ô∏è‚É£ Year of Sane C++">
                    1Ô∏è‚É£ Year of Sane C++
                    <br>
                </a>
            </li>
                <li>
                    <a class="secondary" href="https://pagghiu.github.io/site/blog/2024-11-30-SaneCppLibrariesUpdate.html" title="Permalink to üå´Ô∏è Sane C++ November 24">
                    üå´Ô∏è Sane C++ November 24
                    <br>
                </a>
            </li>
                <li>
                    <a class="secondary" href="https://pagghiu.github.io/site/blog/2024-08-30-SaneCppLibrariesUpdate.html" title="Permalink to üåä Sane C++ August 24">
                    üåä Sane C++ August 24
                    <br>
                </a>
            </li>
                <li>
                    <a class="secondary" href="https://pagghiu.github.io/site/blog/2024-07-31-SaneCppLibrariesUpdate.html" title="Permalink to üèñÔ∏è Sane C++ July 24">
                    üèñÔ∏è Sane C++ July 24
                    <br>
                </a>
            </li>
                <li>
                    <a class="secondary" href="https://pagghiu.github.io/site/blog/2024-06-30-SaneCppLibrariesUpdate.html" title="Permalink to ‚òÄÔ∏è Sane C++ June 24">
                    ‚òÄÔ∏è Sane C++ June 24
                    <br>
                </a>
            </li>
                <li>
                    <a class="secondary" href="https://pagghiu.github.io/site/blog/2024-05-31-SaneCppLibrariesUpdate.html" title="Permalink to üå∏ Sane C++ May 24">
                    üå∏ Sane C++ May 24
                    <br>
                </a>
            </li>
                <li>
                    <a class="secondary" href="https://pagghiu.github.io/site/blog/2024-04-27-SaneCppLibrariesUpdate.html" title="Permalink to üí§ Sane C++ April 24">
                    üí§ Sane C++ April 24
                    <br>
                </a>
            </li>
                <li>
                    <a class="secondary" href="https://pagghiu.github.io/site/blog/2024-03-27-SaneCppLibrariesUpdate.html" title="Permalink to ‚òîÔ∏è Sane C++ March 24">
                    ‚òîÔ∏è Sane C++ March 24
                    <br>
                </a>
            </li>
                <li>
                    <a class="secondary" href="https://pagghiu.github.io/site/blog/2024-02-23-SaneCppLibrariesUpdate.html" title="Permalink to üé† Sane C++ February 24">
                    üé† Sane C++ February 24
                    <br>
                </a>
            </li>
                <li>
                    <a class="secondary" href="https://pagghiu.github.io/site/blog/2024-01-23-SaneCppLibrariesUpdate.html" title="Permalink to ‚ùÑÔ∏è Sane C++ January 24">
                    ‚ùÑÔ∏è Sane C++ January 24
                    <br>
                </a>
            </li>
                <li>
                    <a class="secondary" href="https://pagghiu.github.io/site/blog/2023-12-23-SaneCppLibrariesRelease.html" title="Permalink to üéâ Sane C++ Libraries">
                    üéâ Sane C++ Libraries
                    <br>
                </a>
            </li>
            </ul>
        </details>
    </nav>
</aside>
  <hgroup>
    <p class="chapter">Mon 31 March 2025</p>
    <h1 id="section-0">‚òîÔ∏è Sane C++ March 25</h1>
    
    <figure>
      <img src="https://pagghiu.github.io/images/2025-03-31-SaneCppLibrariesUpdate/article.png" alt="SC" />
    </figure>
    <p>
      <p>Welcome to the update post for March 2025!<br> This month has been mostly spent adding custom allocators support to all Containers!</p>
    </p>
  </hgroup>
  <aside id="table-of-contents">
    <nav class="is-sticky-above-lg ">
      <details open="">
        <summary>Content</summary>
        <div class="col-lg-3 hidden-xs hidden-sm">
          <ul>
            <li><a class="secondary" href="#section-0">Sane C++ March 25</a></li>
            <li><a class="secondary" href="#scfoundation"> SC::Foundation</a></li>
            <li><a class="secondary" href="#custom-allocators"> Custom Allocators</a></li>
            <li><a class="secondary" href="#relative-pointers"> Relative Pointers</a></li>
            <li><a class="secondary" href="#inline-header"> Inline Header</a></li>
            <li><a class="secondary" href="#virtual-memory"> Virtual Memory</a></li>
            <li><a class="secondary" href="#memory-statistics"> Memory Statistics</a></li>
            <li><a class="secondary" href="#vector-growth-factor">Vector Growth Factor</a></li>
            <li><a class="secondary" href="#debug-visualizers">Debug visualizers</a></li>
            <li><a class="secondary" href="#scbuild"> SC::Build</a></li>
            <li><a class="secondary" href="#minor-changes"> Minor Changes</a></li>
          </ul>
        </div>
      </details>
    </nav>
  </aside>
  <div id="content" role="document">
    <h3 id="scfoundation">SC::Foundation</h3>
<p>The big <code>Segment</code> refactoring from last month has left so many trails also during March in <a href="https://pagghiu.github.io/SaneCppLibraries/library_foundation.html"><code>SC::Foundation</code></a>.<br>
Most notably <code>Segment</code> now:</p>
<ol>
<li>Supports custom allocators (WIP)</li>
<li>Uses relative pointers to store <em>dynamically allocated</em> block information</li>
<li>Stores its header inline instead of making it part of the <em>dynamic allocation</em></li>
</ol>
<h4 id="custom-allocators">Custom allocators</h4>
<ul>
<li>Implementation differs from STL one of embedding allocator in the type, as a template parameter.  </li>
<li>Keeping allocator out of the template parameters allows functions to just accept <code>Vector&lt;T&gt;&amp;</code> without needing to care what allocator has been set for it and avoiding the <em>viral</em> effect of needing to make also the method templated around the allocator (that is really bad for compile times).</li>
<li>Allocators are not stored for each single container or dynamic allocation, they're by all means a global.</li>
<li>They're arranged in a double-linked list and users can push / pop their custom one as needed.</li>
<li>This makes it easy for example to create strategies where all allocations in a given sub-scope are sliced from a pre-allocated slab of memory that can be later on released all at once.  </li>
<li>Custom allocators must be considered still WIP and their API will likely change.
Also documentation about their usage is insufficient and it will be expanded.</li>
</ul>
<p><a href="https://pagghiu.github.io/site/blog/CustomFixedAllocator.png" target="_blank">
<img src="https://pagghiu.github.io/site/blog/CustomFixedAllocator.png">
</a></p>
<p>Detailed list of commits: </p>
<ul>
<li><a href="https://github.com/Pagghiu/SaneCppLibraries/commit/50d184e5">Foundation: Add FixedAllocator</a></li>
<li><a href="https://github.com/Pagghiu/SaneCppLibraries/commit/703372d3">Foundation: Add global and thread-local allocators</a></li>
<li><a href="https://github.com/Pagghiu/SaneCppLibraries/commit/f31955c">Foundation: Add allocation ownership mechanism</a></li>
<li><a href="https://github.com/Pagghiu/SaneCppLibraries/commit/938292a6">Foundation: Add alignment support to allocators</a></li>
<li><a href="https://github.com/Pagghiu/SaneCppLibraries/commit/a61fba94">Foundation: Add Global and Thread-Local enum</a></li>
<li><a href="https://github.com/Pagghiu/SaneCppLibraries/commit/4a3f51c">Containers: Add thread-local Vector and SmallVector containers</a></li>
<li><a href="https://github.com/Pagghiu/SaneCppLibraries/commit/fc5fd77">Containers: Use Globals to allocate in ArenaMap</a></li>
<li><a href="https://github.com/Pagghiu/SaneCppLibraries/commit/4a3f51c">Documentation: Add initial documentation for Globals</a></li>
</ul>
<h4 id="relative-pointers">Relative pointers</h4>
<p>Relative pointers make it easier to create data structures that can be bulk serialized and restored skipping parsing entirely.
A specific demo featuring this must still be built but this is definitively on the <code>TODO</code> list.
Relative pointers are quite tricky to implement properly in C++ because it's very easy to trigger UB with this specific class of pointer arithmetics and this has been learned the hard way.
Some tests where failing on GCC (when compiling with <code>-fstrict-aliasing</code>) but it has been a good occasion to learn about <code>std::launder</code> and <code>std::start_lifetime_as</code> family of functions and in general creating optimization barriers with <code>volatile</code> specifier.<br>
For now relative pointers are used by default but at some point the performance impact due to their use will be assessed.
In case of a significant performance difference maybe it will be re-considered possible to opt-out their usage with some runtime or compile-time flag.</p>
<ul>
<li><a href="https://github.com/Pagghiu/SaneCppLibraries/commit/8a00000e">Foundation: Use relative pointers in Segment and make header inline</a></li>
<li><a href="https://github.com/Pagghiu/SaneCppLibraries/commit/ac70d9cc">Foundation: Launder Segment::data() returned pointer</a></li>
<li><a href="https://github.com/Pagghiu/SaneCppLibraries/commit/7a97c14f">Foundation: Refactor Segment to reduce and isolate UB</a></li>
</ul>
<p><a href="https://pagghiu.github.io/site/blog/RelativePointer.png" target="_blank">
<img src="https://pagghiu.github.io/site/blog/RelativePointer.png">
</a></p>
<h4 id="inline-header">Inline header</h4>
<p><code>SegmentHeader</code> is now part of <code>Segment</code> declaration. In other words it's no more part of its dynamically allocated part.
This is useful to know all properties of a segment like its inline storage and capacity or the use of custom allocators.
The inline header stores also information about needing to use the <code>Global</code> or the <code>Thread-Local</code> allocator.<br>
This helps avoiding unnecessary thread-local access because it's useless if all allocations are known to be done from the main thread (or from a specific thread).</p>
<ul>
<li><a href="https://github.com/Pagghiu/SaneCppLibraries/commit/0a17bd41">Foundation: Explicitly reference header from VTable</a></li>
<li><a href="https://github.com/Pagghiu/SaneCppLibraries/commit/76e56e5c">Foundation: Fix Segment::isInline</a></li>
</ul>
<p><a href="https://pagghiu.github.io/site/blog/SegmentHeader.png" target="_blank">
<img src="https://pagghiu.github.io/site/blog/SegmentHeader.png">
</a></p>
<h4 id="virtual-memory">Virtual Memory</h4>
<p>A class called <code>VirtualMemory</code> enables reserving large amounts (max value) of memory and then committing the needed one keeping existing allocation address stable.
This is a big win in many cases because it avoids needing to move everything when a dynamic vector needs to expand, as long as it will be under the <em>max value</em> guessed during the Virtual Memory initialization. This max value can be very large as long as it stays in the allowed virtual memory available range for the given architecture, and in case of 64 bits that's pretty big.</p>
<p><a href="https://pagghiu.github.io/site/blog/VirtualMemoryTest.png" target="_blank">
<img src="https://pagghiu.github.io/site/blog/VirtualMemoryTest.png">
</a></p>
<p>An associated <code>VirtualAllocator</code> enables using it with the Segment allocator subsystem.</p>
<p><a href="https://pagghiu.github.io/site/blog/CustomVirtualAllocator.png" target="_blank">
<img src="https://pagghiu.github.io/site/blog/CustomVirtualAllocator.png">
</a></p>
<ul>
<li><a href="https://github.com/Pagghiu/SaneCppLibraries/commit/e6d93749">Foundation: Add VirtualAllocator</a></li>
<li><a href="https://github.com/Pagghiu/SaneCppLibraries/commit/0cdbeb1f">Foundation: Add VirtualMemory</a></li>
</ul>
<h4 id="memory-statistics">Memory Statistics</h4>
<p>All allocations, deallocations and reallocations are now being counted in a <code>Statistics</code> class providing useful information about how many allocations are done by a given section of code.
The <code>SCTest</code> is using such statistics to assert when detecting a mismatched number of <code>allocate</code> vs <code>release</code> calls.</p>
<ul>
<li><a href="https://github.com/Pagghiu/SaneCppLibraries/commit/878f7627">Testing: Add global memory report</a></li>
<li><a href="https://github.com/Pagghiu/SaneCppLibraries/commit/d22c7593">Foundation: Record statistics in MemoryAllocator</a></li>
</ul>
<p><a href="https://pagghiu.github.io/site/blog/MemoryReport.png" target="_blank">
<img src="https://pagghiu.github.io/site/blog/MemoryReport.png">
</a></p>
<h4 id="vector-growth-factor">Vector Growth Factor</h4>
<p>This has been also been the occasion to feel ashamed about how many allocations where actually already done leading to make Segment grow by factor of <code>2</code> on append.</p>
<ul>
<li><a href="https://github.com/Pagghiu/SaneCppLibraries/commit/390ce729">Foundation: Grow Segment capacity with factor 2 on append or insert</a></li>
</ul>
<h4 id="debug-visualizers">Debug visualizers</h4>
<p>Debug visualizers have been updated to reflect changes in <code>Segment</code> data layout.<br>
Also a LLDB visualizer for <code>Array&lt;T, N&gt;</code> was missing and it has been added as well.</p>
<ul>
<li><a href="https://github.com/Pagghiu/SaneCppLibraries/commit/bfc0c827">DebugVisualizer: Update Segment visualizers to use relative pointers</a></li>
</ul>
<p><a href="https://pagghiu.github.io/site/blog/DebugVisualizers.png" target="_blank">
<img src="https://pagghiu.github.io/site/blog/DebugVisualizers.png">
</a></p>
<h4 id="and-more">And more</h4>
<p>Additional minor fixes that don't deserve a whole paragraph to describe them are listed below:</p>
<ul>
<li><a href="https://github.com/Pagghiu/SaneCppLibraries/commit/e5c5041f">Foundation: Add no-except to all Segment related methods</a></li>
<li><a href="https://github.com/Pagghiu/SaneCppLibraries/commit/abb0b0b6">Foundation: Enable creation of Span<void></a></li>
<li><a href="https://github.com/Pagghiu/SaneCppLibraries/commit/1ed98c28">Foundation: Extend Segment assign and insert to types convertible to T</a></li>
<li><a href="https://github.com/Pagghiu/SaneCppLibraries/commit/92eff60a">Foundation: Fix memory Leak in Segment::shrink_to_fit</a></li>
<li><a href="https://github.com/Pagghiu/SaneCppLibraries/commit/a6ad7dfd">Foundation: Split Foundation.cpp content in separate files</a></li>
<li><a href="https://github.com/Pagghiu/SaneCppLibraries/commit/0cffe20e">Containers: Move SmallVector to Vector header</a></li>
</ul>
<h3 id="scbuild">SC::Build</h3>
<p><a href="https://pagghiu.github.io/SaneCppLibraries/library_build.html"><code>SC::Build</code></a> has received a small set of changes too.
It's now always using the C++ stdlib on GCC because only more recent GCC versions (&gt; 13) support the <code>-nostdlib++</code> flag that makes it easy linking <code>libc</code> but not <code>libc++</code> or <code>libstdc++</code>.</p>
<p>Also Makefiles for apple and linux platforms are now created in separate sub-directories.
This makes it easier to manually invoke make for them as you don't need the flag to indicate a custom Makefile file name.</p>
<p><a href="https://pagghiu.github.io/site/blog/SCBuildMarch25.png" target="_blank">
<img src="https://pagghiu.github.io/site/blog/SCBuildMarch25.png">
</a></p>
<p>This is the detailed list of commits:</p>
<ul>
<li><a href="https://github.com/Pagghiu/SaneCppLibraries/commit/bbb46ea1">Build: Always link C++ stdlib on GCC</a></li>
<li><a href="https://github.com/Pagghiu/SaneCppLibraries/commit/734b73b4">Build: Create Makefiles in apple / linux subdirs</a></li>
<li><a href="https://github.com/Pagghiu/SaneCppLibraries/commit/9dc9792d">Build: Fix enabling standard C++ library for gcc</a></li>
</ul>
<h3 id="minor-changes">Minor Changes</h3>
<p>And the obvious list of random fixes, with the notable mention of the one related to <code>SC::Async</code> that was randomly failing in the CI very often due to some bad copy and paste from the <code>io_uring</code> headers.</p>
<ul>
<li><a href="https://github.com/Pagghiu/SaneCppLibraries/commit/6d288b0d">Everywhere: Fixes to compile under ClangCL</a></li>
<li><a href="https://github.com/Pagghiu/SaneCppLibraries/commit/59efa2fc">Async: Just fill the entire SQE with zero inside io_uring_prep_rw on Linux</a></li>
<li><a href="https://github.com/Pagghiu/SaneCppLibraries/commit/9ef93dad">Async: Set to zer all SQE fields for Linux on io_uring</a></li>
<li><a href="https://github.com/Pagghiu/SaneCppLibraries/commit/f60358e0">Documentation: Fix some typos for build instructions</a></li>
<li><a href="https://github.com/Pagghiu/SaneCppLibraries/commit/443c38e9">SerializationBinary: Fix UB on buffer reader</a></li>
<li><a href="https://github.com/Pagghiu/SaneCppLibraries/commit/d003f221">Containers: Use placementNew in ArenaMap</a></li>
</ul>
  </div>

    </main>
    <footer>
      <div class=" container">
            <section>
              <nav class="links">
                <ul>
                  <li><strong>Projects</strong></li>

                    <li><a  aria-current="page" class="secondary" href="https://pagghiu.github.io/pages/sane-c-libraries.html"
                        title="Permalink to Sane C++ Libraries">Sane C++ Libraries
                    </a></li>

                    </ul>
                <ul>
                  <li><strong>Blog</strong></li>
                  <li><a class="secondary" href="https://pagghiu.github.io/site/blog/blog.html">All Posts</a></li>
                </ul>
                <ul>
                  <li><strong>About</strong></li>
                  <li><a class="secondary" href="https://pagghiu.github.io/site/pages/about.html">About this blog</a></li>
                </ul>
              </nav>
              <p class="build-info">&copy; 2023-2024<!-- --> <a rel="noopener noreferrer" class="secondary"
                  href="https://pagghiu.github.io/site/pages/about.html" target="_blank">Stefano Cristiano</a>.</p>
            </section>
      </div>
      </footer>
  </body>
</html>